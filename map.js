

let fieldData = [
  0,0,395,0,0,488,489,0,0,0,0,0,0,488,489,0,0,0,0,0,0,0,0,488,489,0,488,489,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,504,505,0,488,489,0,0,0,504,505,0,0,488,489,0,480,0,0,504,505,0,504,505,0,0,0,0,0,488,489,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,504,505,0,0,48,0,0,0,0,504,505,490,490,490,0,0,0,0,0,0,16,0,0,0,0,504,505,0,0,0,395,0,0,
  0,0,395,414,448,0,0,0,0,0,0,0,64,222,0,0,0,0,0,474,474,474,0,0,0,0,0,236,32,236,0,0,0,0,0,0,413,414,395,0,0,
  0,0,395,430,464,0,0,0,0,0,452,453,453,453,454,0,0,0,0,490,491,490,0,0,0,0,452,453,453,453,454,0,0,0,0,0,429,430,395,0,0,
  0,0,395,453,453,453,454,0,0,0,0,0,0,0,0,0,0,0,0,490,492,490,0,0,0,0,0,0,0,0,0,0,0,0,452,453,453,453,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,452,453,453,453,453,453,454,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,506,506,0,0,0,452,453,453,453,454,0,0,0,506,506,0,0,369,0,0,506,506,0,0,0,452,453,453,453,454,0,0,0,506,506,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,506,506,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,506,506,0,0,0,0,0,0,395,0,0,
  0,0,395,453,453,453,454,0,0,0,0,0,0,0,506,506,0,506,506,506,506,506,506,0,506,506,506,0,0,0,0,0,0,0,452,453,453,453,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,506,506,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,506,506,0,0,0,0,0,395,395,395,
  0,0,395,506,506,0,0,0,0,0,0,0,0,0,0,0,506,506,506,506,506,506,506,506,506,0,0,0,0,0,0,0,0,0,0,0,506,506,0,0,395,
  0,0,395,0,0,0,0,506,506,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,506,506,0,0,0,0,0,369,395,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,
  0,0,395,0,0,0,0,0,0,374,0,0,0,0,0,0,0,0,0,372,369,372,0,0,0,0,0,0,0,0,0,374,0,0,0,0,0,0,395,395,395,
  0,0,395,0,0,0,174,0,0,0,174,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,174,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,169,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,103,0,0,0,0,185,0,0,0,0,0,395,0,0,
  0,0,395,372,372,372,372,375,375,375,375,375,372,372,372,372,372,375,375,375,0,375,375,375,372,372,372,372,372,375,375,375,375,375,372,372,372,372,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,375,375,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,375,375,395,0,0,
  0,0,395,374,374,374,374,0,0,374,0,0,374,374,374,372,372,372,374,374,374,374,374,372,372,372,374,374,374,0,0,374,0,0,374,374,374,374,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,423,424,424,424,425,0,0,0,372,372,372,0,0,0,0,0,372,372,372,0,0,0,423,424,424,424,425,0,0,0,0,395,0,0,
  0,0,395,0,0,0,0,0,0,407,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,407,0,0,0,0,0,0,395,0,0,
  0,0,395,414,448,0,0,0,0,407,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,407,0,0,0,0,413,414,395,0,0,
  0,0,395,430,464,0,0,0,0,407,0,372,372,372,0,0,0,0,0,372,369,372,0,0,0,0,0,372,372,372,0,407,0,0,0,0,429,430,395,0,0,
  0,0,395,418,418,418,419,0,0,407,0,0,0,0,0,376,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,407,0,0,417,418,418,418,395,0,0,
  0,0,395,434,434,434,435,0,0,407,0,0,0,0,394,392,0,0,0,0,0,0,0,0,0,0,0,0,0,0,394,407,0,0,433,434,434,434,395,0,0,
  0,0,395,450,450,450,451,0,0,407,508,509,510,0,407,408,0,508,509,510,0,0,0,0,0,508,509,510,0,0,407,407,0,0,449,450,450,450,395,0,0,
  0,0,395,450,450,417,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,418,419,450,450,395,0,0,
  0,0,395,450,450,433,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,434,435,450,450,395,0,0,
  0,0,395,450,450,449,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,451,450,450,395,0,0
  
  
  
  
  
  
  

];


//----368からのブロックのタイプ-------
  let blType = [
    1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,
    0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,
    1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,
    1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,
    0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,1,
    1,0,0,0,1,1,1,0,1,0,0,0,1,1,1,1,
    1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
    1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,
    1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,

  ];

class Field {

  constructor() {
    this.scx = 0;
    this.scy = 0;
  }

  //----ブロックかどうか返す--------
  isBlock(x,y) {
    let block = fieldData[(y>>4) * FIELD_SIZE_W + (x>>4)];
    if(block<368)return 0;
    // if(block == 372)return 372;////
    return blType[block-368]==1?block:0;
  }

  update() {             //-----マリオに合わせて画面移動-----
    // console.log(ojisan.x>>4);
    if( (ojisan.x>>4) > field.scx + 348  ) {
      field.scx = (ojisan.x>>4)  - 348;
    }
    if( (ojisan.x>>4) < field.scx + 308 ) {
      field.scx = (ojisan.x>>4) - 308;
    }
    if( (ojisan.x>>4) < 152 ) {
      field.scx = -156;     //-------カメラが一番左で止まる-----
    }
    if( (ojisan.x>>4) > 504 ) {
      field.scx = 156;     //-------カメラが一番右で止まる-----
    }

    if( (ojisan.y>>4) < field.scy + 320 ) {
      field.scy = (ojisan.y>>4) - 320;
    }
    if(ojisan.FALL == false) {
      if( (ojisan.y>>4) > field.scy + 386 ) {
        field.scy = (ojisan.y>>4) - 386;
          if((ojisan.y>>4) > 540){
            field.scy = 160; 
          }
        }
    }

    // if( (ojisan.y>>4) < 100 ) {
    //   field.scy = -262;     //-------カメラが一番上で止まる-----
    // }
    // if( (ojisan.y>>4) > 576 ) {
    //   field.scy = 160;     //-------カメラが一番下で止まる-----
    // }

    
  }

  drawBlock(block,px,py){
    const anime = [0,1,2,1,0];   //-----?BOXのキラキラ--------
    if(block == 368){
      if(ojisan.FALL == false){
        block += anime[(frameCount>>3)%5];
      }
    }

    let sx = (block&15)*16;
    let sy = (block>>4)*16;
    vcon.drawImage(chImg,sx,sy,16,16, px,py,16,16);

  }


  draw() {

    for(let y = 0; y < MAP_SIZE_H+1; y++) {
      for(let x = 0; x < MAP_SIZE_W+1; x++) {

        let sx = x + (this.scx>>4);
        let sy = y + (this.scy>>4);
        let block = fieldData[sy * FIELD_SIZE_W + sx];
        let px = x * 16 - (this.scx&15);
        let py = y * 16 - (this.scy&15);

        if(block > 0)this.drawBlock(block-1,px,py);
    
      }
    }

  }

}